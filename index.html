<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ツールコレクション</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="script.js" defer></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
  <!-- 页面标题 -->
  <header class="text-center mb-10">
    <h1 class="text-3xl font-extrabold text-indigo-700">坊ちゃんのツールコレクション</h1>
    <p class="text-gray-500 mt-2">君と共に在れ</p>
  </header>

  <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-[350px_480px_1fr] gap-8 items-start [--col-h:560px]">
    
    <!-- 左边竖排 -->
    <div class="flex flex-col gap-6">
      <!-- 坊ちゃん -->
      <section class="bg-white shadow-lg rounded-2xl p-6 flex flex-col justify-between">
        <div>
          <div class="flex items-center gap-4 mb-4">
            <img src="./avatar.jpeg" alt="avatar" class="w-16 h-16 rounded-full shadow-md border-4 border-indigo-300">
            <div>
              <h2 class="text-xl font-bold text-indigo-700">熾天使の香炉</h2>
              <p class="text-gray-600 text-sm">県・町データを処理して、新しい分析ファイルを生成しよう！</p>
            </div>
          </div>

          <input type="file" id="fileInput" class="block w-full text-sm text-gray-500 mb-4
            file:mr-4 file:py-2 file:px-4
            file:rounded-full file:border-0 file:text-sm file:font-semibold
            file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
        </div>

        <button onclick="processFile()" class="w-full bg-indigo-600 text-white px-6 py-2 rounded-full shadow hover:bg-indigo-700 transition">
          処理してダウンロード
        </button>
      </section>

      <!-- 永恩 -->
      <section class="bg-white shadow-lg rounded-2xl p-6 flex flex-col justify-between">
        <div>
          <div class="flex items-center gap-4 mb-4">
            <img src="./yongen.jpg" alt="avatar" class="w-16 h-16 rounded-full shadow-md border-4 border-indigo-300">
            <div>
              <h2 class="text-xl font-bold text-indigo-700">忘られざる者　ヨネ</h2>
              <p class="text-gray-600 text-sm">仕分けコードを生成しよう！</p>
            </div>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">斬命刀</label>
            <input type="file" id="mappingFile" class="block w-full text-sm text-gray-500
              file:mr-4 file:py-2 file:px-4
              file:rounded-full file:border-0 file:text-sm file:font-semibold
              file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
          </div>
  
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">縛魂の解放</label>
            <input type="file" id="targetFile" class="block w-full text-sm text-gray-500
              file:mr-4 file:py-2 file:px-4
              file:rounded-full file:border-0 file:text-sm file:font-semibold
              file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
          </div>
        </div>

        <button onclick="processMapping()" class="w-full bg-green-600 text-white px-6 py-2 rounded-full shadow hover:bg-green-700 transition">
          冥封一閃
        </button>
      </section>
    </div>

    <!-- 右边：ヤキモチ -->
  <section class="bg-white shadow-lg rounded-2xl p-6 h-[576px]">
    <div class="mx-auto">
      <div class="flex items-center gap-4 mb-4">
        <img src="./jiushu.jpeg" alt="avatar" class="w-16 h-16 rounded-full shadow-md border-4 border-green-300">
        <div>
          <h2 class="text-xl font-bold text-green-700">リデンプション</h2>
          <p class="text-gray-600 text-sm">MAWBごとにE始まりAWBと住所を集計するツール</p>
        </div>
      </div>

      <input type="file" id="eStatsInput" class="block w-full text-sm text-gray-500 mb-4
        file:mr-4 file:py-2 file:px-4
        file:rounded-full file:border-0 file:text-sm file:font-semibold
        file:bg-green-50 file:text-green-700 hover:file:bg-green-100"/>

      <div class="flex gap-3">
        <button id="runEBtn" onclick="analyzeEStats()" class="flex-1 w-full bg-green-600 text-white px-6 py-2 rounded-full shadow hover:bg-green-700 transition">
          集計して表示
        </button>
        <button id="resetEBtn" onclick="resetEView()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-full shadow hover:bg-gray-300 transition hidden">
          リセット
        </button>
      </div>

      <!-- 占位图片区（等比+铺满+圆角统一） -->
      <div id="placeholderImage" class="mt-6">
        <div class="relative w-full rounded-xl overflow-hidden aspect-[16/12] shadow-md">
          <img src="./zenyin.jpg" alt="placeholder"
              class="absolute inset-0 w-full h-full object-cover" />
        </div>
      </div>


      <!-- 结果表格（初始隐藏：max-height=0, opacity=0） -->
      <div id="eStatsResult" class="mt-6 overflow-x-auto transition-all duration-700" style="max-height:0; opacity:0; overflow:hidden;">
        <div class="max-h-96 overflow-y-auto"> <!-- 限高并允许纵向滚动 -->
          <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden text-sm">
            <thead class="bg-green-100 text-green-800 sticky top-0">
              <tr>
                <th class="px-4 py-2 border">MAWB番号</th>
                <th class="px-4 py-2 border">E開頭 件数</th>
                <th class="px-4 py-2 border">大阪 件数</th>
                <th class="px-4 py-2 border">滋賀 件数</th>
                <th class="px-4 py-2 border">差分</th>
              </tr>
            </thead>
            <tbody id="eStatsTable" class="text-gray-700">
              <!-- JS 填充 -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

    <!-- 右列：窃法之刃（整列撑满；加入 placeholder；内部滚动） -->
    <section class="h-full bg-white shadow-lg rounded-2xl p-6 flex flex-col">
      <div class="shrink-0 flex items-center gap-4 mb-4">
        <img src="./aili.png" alt="avatar" class="w-16 h-16 rounded-full shadow-md border-4 border-indigo-300">
        <div>
          <h2 class="text-xl font-bold text-indigo-700">艾黎</h2>
          <p class="text-gray-600 text-sm">Code Generator</p>
        </div>
      </div>

      <div class="shrink-0">
        <input type="file" id="dedupFile" class="block w-full text-sm text-gray-500 mb-4
          file:mr-4 file:py-2 file:px-4
          file:rounded-full file:border-0 file:text-sm file:font-semibold
          file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
        
        <div class="flex gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">前缀数字</label>
            <input type="text" id="codePrefix" inputmode="numeric" pattern="[0-9]*" placeholder="例：23"
              class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-300" />
    
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">后缀数字</label>
            <input type="text" id="codeSuffix" inputmode="numeric" pattern="[0-9]*" placeholder="例：23"
                class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-300" />
          </div>

        </div>

       
        <div class="flex gap-3 mt-3">
          <button id="runDedupBtn" onclick="buildCodesFromSheet2()"
            class="flex-1 bg-indigo-600 text-white px-6 py-2 rounded-full shadow hover:bg-indigo-700 transition">
            生成して表示
          </button>
          <button id="resetDedupBtn" onclick="resetDedupView()"
            class="bg-gray-200 text-gray-700 px-4 py-2 rounded-full shadow hover:bg-gray-300 transition hidden">
            リセット
          </button>
        </div>
      </div>

    <!-- 右侧占位图（等比+铺满+圆角统一） -->
      <div id="dedupPlaceholder" class="mt-6">
        <div class="relative w-full rounded-xl overflow-hidden aspect-[16/11] shadow-md">
          <img src="./Lulu_1 (1).jpg" alt="placeholder"
              class="absolute inset-0 w-full h-full object-cover" />
        </div>
      </div>


        <!-- 结果表格（固定高度内滚） -->
        <div id="dedupResult" class="mt-4 transition-opacity duration-700 ease-in-out opacity-0 hidden">
          <div class="max-h-[60vh] overflow-y-auto">
            <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden text-sm">
              <thead class="bg-indigo-100 text-indigo-800 sticky top-0">
                <tr>
                  <th class="px-4 py-2 border">生成コード</th>
                  <th class="px-4 py-2 border">H 列（去重值）</th>
                </tr>
              </thead>
              <tbody id="dedupTable" class="text-gray-700"></tbody>
            </table>
            <div id="dedupMeta" class="text-xs text-gray-500 mt-2 text-center"></div>
          </div>
        </div>
    </section>
  </main>
</body>
</html>
